/**
 * A custom sample node module that handles native file interactions.
 *
 * This is a bit quick and dirty. It is just as a simple example of what a 
 * custom node module can look like so we have something to use for our test.
 *
 */

 		// Require the NodeJs fs (filesystem) module
 		// See http://nodejs.org/api/fs.html
var fs = require('fs');

function FSExplorer() {

	/**
	 * Read the contents of a local folder / directory.
	 * Simple example. Does not recurse.
	 */
	function readdir(path,callback) {

								// Start by getting the status of the folder 
        fs.lstat(
        						// The path to the folder
          	path, 
          						// The callback. Err will be null if no errors
          	function (err, stat) {
	            if (err) { 
	                return callback(err) 
	            }
	            				// Have we got a directory ?
	            if (stat.isDirectory()) {
	            				// Ok, read the directory
	                fs.readdir(
		              	path, 
		              	function (err, files) {

			                	// Get the data for files and folders in this directory 
			                var fileDetails = [];
			                files.forEach(function(file, i){
			                	var abspath = path + '/' + file;
			                	var fileStat = fs.statSync(abspath);

			                	var details = {
			                		name 		: file,
			                		size 		: fileStat.size,
			                		created 	: fileStat.birthtime,
			                		modified 	: fileStat.mtime,
			                		isDir 		: (fileStat.isDirectory())
			                	}

			                    fileDetails.push(details);
			                })
			                	// Return the details as an array
			                	// along with the path we started with
			                return callback(null, path, fileDetails);
		                }
	                );

	            } else {
	              return callback(new Error("path: " + path + " is not a directory"));
	            }
        	}
        );

	}
	
	this.readdir = readdir;
}

module.exports = new FSExplorer;
